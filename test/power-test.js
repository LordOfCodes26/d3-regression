const tape = require("tape"),
      d3 = require("../");

tape("pow.domain(domain) sets the domain explicitly", function(test) {
  const r = d3.regressionPow().domain([0, 50]);
  test.deepEqual(r.domain(), [0, 50]);
  test.end();
});

tape("pow(data) calculates the the a and b coefficients, R^2, and returns a line representing the regression", function(test) {
  const data = [{"x":1,"y":82.74},{"x":2,"y":40.24},{"x":3,"y":35.82},{"x":4,"y":33},{"x":5,"y":31.37},{"x":6,"y":30.26},{"x":7,"y":30.01},{"x":8,"y":29.02},{"x":9,"y":28.62},{"x":10,"y":28.31},{"x":20,"y":20.22},{"x":30,"y":14.76},{"x":40,"y":13.04},{"x":50,"y":11.33},{"x":60,"y":10.42},{"x":70,"y":9.49},{"x":80,"y":8.49},{"x":90,"y":7.81},{"x":100,"y":7.34},{"x":200,"y":5.08},{"x":300,"y":4.01},{"x":400,"y":3.36},{"x":500,"y":2.89},{"x":600,"y":2.57},{"x":700,"y":2.28},{"x":800,"y":2.09},{"x":900,"y":1.92},{"x":1000,"y":1.76},{"x":1100,"y":1.66},{"x":1200,"y":1.55},{"x":1300,"y":1.46},{"x":1400,"y":1.39},{"x":1500,"y":1.32},{"x":1600,"y":1.24},{"x":1700,"y":1.19},{"x":1800,"y":1.14},{"x":1900,"y":1.08},{"x":2000,"y":1.04},{"x":2100,"y":0.99},{"x":2200,"y":0.94},{"x":2300,"y":0.9},{"x":2400,"y":0.87},{"x":2500,"y":0.83},{"x":2600,"y":0.79},{"x":2700,"y":0.76},{"x":2800,"y":0.73},{"x":2900,"y":0.71},{"x":3000,"y":0.68},{"x":3100,"y":0.65},{"x":3200,"y":0.63},{"x":3300,"y":0.61},{"x":3400,"y":0.59},{"x":3500,"y":0.58},{"x":3600,"y":0.56},{"x":3700,"y":0.54},{"x":3800,"y":0.53},{"x":3900,"y":0.51},{"x":4000,"y":0.5},{"x":4100,"y":0.48},{"x":4200,"y":0.47},{"x":4300,"y":0.46},{"x":4400,"y":0.45},{"x":4500,"y":0.43},{"x":4600,"y":0.42},{"x":4700,"y":0.41},{"x":4800,"y":0.4},{"x":4900,"y":0.39},{"x":5000,"y":0.38}];

  const r = d3.regressionPow()
    .x(d => d.x)
    .y(d => d.y)
    (data);

  test.equal(r.a.toFixed(3), "108.754");
  test.equal(r.b.toFixed(3), "-0.627");
  test.equal(r.rSquared.toFixed(3), "0.832");

  [[1,108.75377499636687],[2,70.42179526158685],[3,54.61386085046994],[4,45.600525113087144],[5,39.646971714489105],[6,35.36434599520863],[7,32.106421081286015],[8,29.527902304466682],[9,27.425933463864904],[10,25.672772507556168],[20,16.623999758949175],[30,12.892326959871342],[40,10.764609389352207],[50,9.359194064514964],[60,8.348223403222796],[70,7.5791469719483056],[80,6.970453379786045],[90,6.474255727203009],[100,6.0603988068161305],[200,3.9243158593016956],[300,3.04340494980397],[400,2.54112896765905],[500,2.2093620205863154],[600,1.970708973369936],[700,1.7891582707695644],[800,1.6454680667383854],[900,1.5283340228491202],[1000,1.4306376020294747],[1100,1.3476514994846842],[1200,1.2761015776000961],[1300,1.2136414293714493],[1400,1.1585412776606436],[1500,1.1094951873132226],[1600,1.0654969476618241],[1700,1.025757530352556],[1800,0.9896486411804434],[1900,0.9566631668322694],[2000,0.9263868615780272],[2100,0.8984776927747168],[2200,0.8726505170404558],[2300,0.8486655377862584],[2400,0.8263194912888685],[2500,0.8054388322628654],[2600,0.7858744053990862],[2700,0.7674972354726005],[2800,0.7501951694112745],[2900,0.7338701743142336],[3000,0.7184361455710193],[3100,0.7038171153446383],[3200,0.68994577799799],[3300,0.6767622684384286],[3400,0.6642131438005883],[3500,0.6522505297523222],[3600,0.6408314009554613],[3700,0.6299169715268862],[3800,0.6194721762183796],[3900,0.6094652268233635],[4000,0.5998672312869252],[4100,0.5906518653362844],[4200,0.5817950883065693],[4300,0.5732748963200791],[4400,0.5650711071684074],[4500,0.5571651722086397],[4600,0.549540011365536],[4700,0.5421798679684008],[4800,0.5350701806732435],[4900,0.5281974701504585],[5000,0.5215492385734836]].forEach((p, i) => {
    test.deepEqual(r[i], p);  
  });

  test.end();
});