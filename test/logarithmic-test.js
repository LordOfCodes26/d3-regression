const tape = require("tape"),
      d3 = require("../");

tape("log.domain(domain) sets the domain explicitly", function(test) {
  const r = d3.regressionLog().domain([0, 50]);
  test.deepEqual(r.domain(), [0, 50]);
  test.end();
});

tape("log(data) calculates the the a and b coefficients, R^2, and returns a line representing the regression", function(test) {
  const data = [{x: 1, y: 4.181}, {x: 2, y: 4.665}, {x: 3, y: 5.296}, {x: 4, y: 5.365}, {x: 5, y: 5.448}, {x: 6, y: 5.744}, {x: 7, y: 5.653}, {x: 8, y: 5.844}, {x: 9, y: 6.362}, {x: 10, y: 6.38}, {x: 11, y: 6.311}, {x: 12, y: 6.457}, {x: 13, y: 6.479}, {x: 14, y: 6.59}, {x: 15, y: 6.74}, {x: 16, y: 6.58}, {x: 17, y: 6.852}, {x: 18, y: 6.531}, {x: 19, y: 6.682}, {x: 20, y: 7.013}, {x: 21, y: 6.82}, {x: 22, y: 6.647}, {x: 23, y: 6.951}, {x: 24, y: 7.121}, {x: 25, y: 7.143}, {x: 26, y: 6.914}, {x: 27, y: 6.941}, {x: 28, y: 7.226}, {x: 29, y: 6.898}, {x: 30, y: 7.392}, {x: 31, y: 6.938}];
  const r = d3.regressionLog()
    .x(d => d.x)
    .y(d => d.y)
    .domain([1e-6, 32])
    (data);

  test.equal(r.a.toFixed(3), "0.881");
  test.equal(r.b.toFixed(3), "4.173");
  test.equal(r.rSquared.toFixed(3), "0.958");

  [[0.000001, -7.995891074267221], [1, 4.173444691380204], [2, 4.7840005401746], [3, 5.141152816315298], [4, 5.394556388968995], [5, 5.591111470193712], [6, 5.751708665109693], [7, 5.887491658684209], [8, 6.005112237763392], [9, 6.108860941250391], [10, 6.2016673189881075], [11, 6.285620899643471], [12, 6.36226451390409], [13, 6.432769804402334], [14, 6.4980475074786055], [15, 6.558819595128806], [16, 6.615668086557788], [17, 6.669069035835358], [18, 6.719416790044788], [19, 6.76704167996782], [20, 6.812223167782504], [21, 6.8551997836193035], [22, 6.896176748437866], [23, 6.9353319010346315], [24, 6.972820362698485], [25, 7.00877824900722], [26, 7.04332565319673], [27, 7.076569066185486], [28, 7.108603356273001], [29, 7.139513401287363], [30, 7.169375443923203], [31, 7.198258224762528], [32, 7.226223935352184]].forEach((p, i) => {
    test.deepEqual(r[i], p);  
  });

  test.end();
});